# Results

```{r include=FALSE}
library(tidyverse)
library(ggplot2)
library(GGally)
library(vcd)
library(RColorBrewer)
library(ggalluvial)
#devtools::install_github("timelyportfolio/parcoords")
library(parcoords)
library(pander)
library(ggridges)
library(patchwork)
library(prismatic)
library(extrafont)
library(cowplot)
library(dplyr)
library(hexbin)
library(jsonlite)
library(httr)
library(scales)
library(RCurl)
library(jpeg)
```

```{r}
shot_data = read_csv("shotchartdetail.csv")
```


In this chapter, we will our process to come up with the answers and our conclusions to each of the questions we proposed in the introduction section. Here are our questions proposed in the introduction chapter:

1. On League Level
We will give a overall glance at the dataset of last season to have a basic understanding on the shooting behaviors.

2. On Team Level
What are some differences between shooting behaviors preferences for each team? Does the preference change period by period? Does the preference corresponds to field goal percentage? 

3. On Player Level
We choose three most popular players, Stephen Curry, Lebron James and Giannis Antetokounmpo to investigate their shooting choices and look at how other variables could influence their shooting decision such as in differnet periods of game.

Note that in the following analysis, we need to plot the NBA court to visualize the shooting data. The code for drawing the court is adapted from https://github.com/toddwschneider/ballr, and the court graph is as follows:

## League Shooting Pattern Analysis

Firstly we will look at the distribution of distance of shots by the entire league.
```{r}
density_graph <- shot_data %>%
  ggplot(aes(x = shot_distance)) + 
  geom_histogram(aes(y = ..density..), bins = 25)+
  geom_density(aes(color = "density curve"))+ 
  labs(title = "Distribution of Shot Distance", x = "Shot Distance (in)", y = "Density")


density_ridges_zone <- shot_data %>% 
  ggplot(aes(x = shot_distance, y=shot_zone_basic)) +
  geom_density_ridges(alpha = .5) + 
  labs(title = "Ridgeline Plots of Shot Distance in Different Zones", x = "Shot Distance (in)", y = "Zone")

density_graph + density_ridges_zone + plot_layout(ncol=1)
```

From the density histogram, we can see that most shots are made around distance of 0 inch and 25 inches. According to the Ridgeline Plots, we can conclude that the shots made around 0 inch distance are in the restricted area, and the shots made around 25 inch distance are all kinds of 3-point shots. This graph shows that the modern basketball tends to shoot less mid-range and try to maximize points per play because the shooting percentage always gets higher when player approaches the basketball.




## Team Shooting Pattern Analysis

One striking difference between teams in shooting pattern is the team's preference for 2-point and 3-point shots. Firstly, to get a general understanding of how many 2-point and 3-point shots each team attempted for season 2020-21, we create a Cleveland Dot Plot as follows:

```{r}
shot_data %>%
  select(team_name, shot_type) %>%
  group_by(team_name,shot_type) %>%
  summarize(n = n(),.groups = 'drop') %>%
  pivot_wider(values_from = n, names_from = shot_type) %>%
  rename_all(make.names) %>%
  rename(two_point_shots = X2PT.Field.Goal, three_point_shots = X3PT.Field.Goal) %>%
  mutate(shots_sum = two_point_shots+ three_point_shots) %>% # calculate total
  arrange(desc(shots_sum)) %>% # order by total
  pivot_longer(cols = c("two_point_shots", "three_point_shots","shots_sum")) %>% # tidy the data
  ggplot(aes(x = value, y = reorder(team_name, value), color = name))+
  geom_point()+
  theme_linedraw()+ 
  labs(title = "2-point and 3-point Total Shots for Each Team", x = "count", y = "Team Name")
```

From the Cleveland Dot Plot, we can see that the total shots made by each team for the entire season doesn't vary a lot, ranging from around 6000 to 6500. However, for different teams, they have different preference for 2-point shots and 3-point shots. For example, Utah Jazz has almost same counts for 2-point shots and 3-point shots with the most 3-point shots in the league. On the contrary, San Antonio Spurs has least count of 3-point shots and most count of 2-point shots in the league. Therefore, we can conclude that teams vary significantly on their choice for making 2-point or 3-point shots.

After generally seeing the preference of different teams, now we can explore the movement of preference for 2-point shots and 3-point shots period by period. To see the preference change, here we calculate the percentage of 3-point shots among all shots made in each period for each team. If the percentage increase, it means that the team prefer to make more 3-point shots.

```{r}
getPalette = colorRampPalette(brewer.pal(9, "Set1"))

period_shots <- shot_data %>%
  filter(period <= 4) %>%
  select(team_name, shot_type, period) %>%
  mutate(period = factor(period)) %>%
  group_by(team_name, shot_type, period) %>%
  summarize(n = n(),.groups = 'drop') %>%
  pivot_wider(names_from = shot_type, values_from = n) %>%
  rename_all(make.names) %>%
  mutate(p = X3PT.Field.Goal/(X3PT.Field.Goal + X2PT.Field.Goal)) %>%
  mutate(three_point_percentage_cut = cut(p, breaks=c(-Inf,0.3,0.35,0.4,0.45,0.5,Inf), 
                            labels=c("<30%", "30%-35%", "35%-40%", "40%-45%","45%-50%","50%+"))) %>%
  mutate(three_point_percentage_cut = as.character(three_point_percentage_cut)) %>% 
  select(-c(X2PT.Field.Goal,X3PT.Field.Goal,p)) %>%
  pivot_wider(names_from = period, values_from = three_point_percentage_cut) 
  
colnames(period_shots) <- c("Name", "Period1", "Period2", "Period3","Period4")

period_shots%>%
  ggplot(aes( axis1 = Period1, axis2 = Period2, axis3 = Period3, axis4 = Period4))+
  geom_alluvium(aes(fill = Name), width = 1/12)+
  geom_stratum(width = 1/12, fill = "grey80", color = "dark grey")+
  geom_label(stat="stratum",
             aes(label = after_stat(stratum)))+
  ggtitle("Alluvial Diagram of 3-point Shots Percentage Change")+
  theme_void()+
  scale_fill_manual(values = getPalette(30))+
  theme(legend.position="bottom",legend.title = element_text(size=4), legend.text = element_text(size=4))

```

*(Here Each color represents one team. The percentage represent the percentage of 3-point shots of total number of shots attempted each period. The first axis means 1st period, and so on.)*

From the graph we can see that, indeed, most of the teams will have different preference for 2-point and 3-point shots regarding to different periods of a game. For example, Brooklyn Nets experienced largest change in the percentage of 3-point shots among other teams: at 1st period, it has percentage between 40% and 35%, and during the 2nd period, the percentage decreased to 35% - 40%. Then during 3rd period, the percentage increased to 40%-45% and finally reached 45%-50% at the 4th period.

A general trend is that, as the game approaches to 4th period, teams tend to make more 3-point shots compared to their performance in 1st period.

After getting a general understanding of types and shots attempted for each team, now we want to focus on the Field Goal Percentage ($\frac{\text{ total shots made}}{\text{total shots attempted}}$).

Here we will use diverging bar chart to compare the Field Goal % for 2-point and 3-point shots for each team, ordering by Field Goal % for 3-point shots:
```{r}
FG_shot_type <- shot_data %>%
  select(team_name, shot_type,shot_attempted_flag,shot_made_flag) %>%
  group_by(team_name,shot_type) %>%
  summarize(attempts = sum(shot_attempted_flag),
            goals = sum(shot_made_flag), .groups = 'drop') %>%
  mutate(FGp = (goals/attempts)*100) %>%
  select(team_name,shot_type,FGp) %>%
  pivot_wider(values_from = FGp, names_from = shot_type)

HH::likert(team_name~., FG_shot_type, positive.order = TRUE,
           main = "FG% for 2-point and 3-point Shots for Each Team", 
           xlab = "Percent", ylab = "Team Name")
```

From the plot, we can see that, generally, 3-point Field Goal is less than 2-point Field Goal, which makes sense because 3-point shots are harder to score regarding to the distance.

It is difficult to see if the FG% for 2-point or 3-point corresponds to the team's preference. Based on our previous conclusion, Utah Jazz has the most number of 3-point shots attempted, and San Antonio Spurs were concluded as the team least preferring 3-point shots. However, the FG% for 3-point shots are not highest for Utah Jazz and not lowest for San Antonio Spurs. This situation may be affected by the fact that, since the team prefer 3-point shots, so they make more, and they miss more, so the FG% decreases.

## Individual Player Analysis

### Shooting behavior of Stephen Curry

As a ground-breaking player, Stephen Curry showed the world how explosive his scoring ability was and he is making a NBA record of three pointers made while this project is getting done. Analyzing his shooting behavior would be a great angle to start.

```{r}
library(RCurl)
shot_steph <- shot_data %>%
  filter(player_name == "Stephen Curry")
# import court background image
courtImg.URL <- "https://thedatagame.files.wordpress.com/2016/03/nba_court.jpg"
court <- rasterGrob(readJPEG(getURLContent(courtImg.URL)),
           width=unit(1,"npc"), height=unit(1,"npc"))
curry_heat <- ggplot(shot_steph, aes(x=loc_x, y=loc_y)) + 
  annotation_custom(court, -250, 250, -50, 420) +
  geom_hex(bins = 40) +
  scale_fill_viridis_c(option = "inferno",direction = -1) +
  xlim(-250, 250) +
  ylim(-50, 420)+
  labs(title = "Stephen Curry Shot Count")+
  theme_void()+
  theme(legend.position="bottom")
# League average FG% on different zones
league_avg <- shot_data %>%
  select(shot_zone_basic, shot_attempted_flag,shot_made_flag) %>%
  group_by(shot_zone_basic) %>%
  summarize(shot_attempted = sum(shot_attempted_flag), shot_made = sum(shot_made_flag)) %>%
  mutate(FGp = shot_made/shot_attempted) %>%
  select('FGp')
# Curry's FG% on different zones
shot_steph_fgp <- shot_steph %>%
  select(shot_zone_basic, shot_attempted_flag,shot_made_flag) %>%
  group_by(shot_zone_basic) %>%
  summarize(shot_attempted = sum(shot_attempted_flag), shot_made = sum(shot_made_flag)) %>%
  mutate(FGp = shot_made/shot_attempted)
# Compare Curry's FG% on different zones with League Average
shot_steph_fgp$league_avg <- league_avg$FGp
shot_steph_fgp$FGp_diff = (shot_steph_fgp$FGp - shot_steph_fgp$league_avg)*100
curry_fg <- shot_steph %>%
  mutate(FG_comp = case_when(shot_zone_basic == "Above the Break 3" ~ shot_steph_fgp$FGp_diff[1],
                             shot_zone_basic == "Backcourt" ~ shot_steph_fgp$FGp_diff[2], 
                             shot_zone_basic == "In The Paint (Non-RA)" ~ shot_steph_fgp$FGp_diff[3], 
                             shot_zone_basic == "Left Corner 3" ~ shot_steph_fgp$FGp_diff[4], 
                             shot_zone_basic == "Mid-Range" ~ shot_steph_fgp$FGp_diff[5], 
                             shot_zone_basic == "Restricted Area" ~ shot_steph_fgp$FGp_diff[6],
                             shot_zone_basic == "Right Corner 3" ~ shot_steph_fgp$FGp_diff[7])) %>%
  ggplot(aes(x=loc_x, y=loc_y)) + 
  annotation_custom(court, -250, 250, -50, 420) +
  geom_point(aes(color = FG_comp)) +
  scale_color_gradient2(midpoint = 0, low = "cornflowerblue", mid = "ivory",
                            high = "brown3", name = "FG% compared to league average" )+
  xlim(-250, 250) +
  ylim(-50, 420)+
  labs(title = "Stephen Curry FG% Compared to League Average")+
  theme_void()+
  theme(legend.position="bottom")
curry_heat | curry_fg
```

These two plots use a graph of basketball court to visualize the performance of Stephen Curry at each point on the court and it divides the court to multiple zones. The color in the left graph indicate the total number of shots made by Stephen Curry, the color in the right graph indicates the field goal percentage of Stephen Curry in that specific zone comparing to the average level of the league. It is red if the player shoots above the league average and blue if lower than league average.

In the plot above, we could first notice that Stephen Curry tries most of his shots in the paint (a rectangle area nearest to the basket) and out of three-point line. Again, this shooting behavior is a classical example of modern basketball: try less on mid-range shot. Another characteristic of his shooting is the range of his threes. We could even see multiple hexagons even 7 feet further away from the three-point line, which makes it harder to guard him.

On the other hand, we could still see that Stephen has his weakness, which is left corner. His left-corner threes are deep blue so it would be a great strategy to limit him to shoot at that place. However, I think he is able to develope becasue he shoots very well on the other corner.


### Shooting pattern in playoffs of LeBron James

We could always say that games of regular season do not really matter because being a championship depends on the performance in playoffs. So many top players choose to take as many rest as they can in regual season so that they could save more energy for the playoffs. Therefore, it would be great if we can find some differences of shooting behavior in regular season and playoffs. As a die-hard Lakers fan, I would choose to analyze LeBron James.

By looking at the regular season shot chart on the left, it is obvious that LeBron did fantastic in the paint, which shows that his advantage near the basketball still exists. In contrary, he also tried a lot mid range shots and threes but the results was not ideal, except that his shooting percentage on the left corner is extremely high, where by chance Stephen Curry was not good at.

Comparing the performance in regular season and playoffs, we could see that although LeBron James still did better than average in the semi-circle area under the basket, his shooting significantly declined in that area. It might be the reason why Lakers in this season did not make it to the finals. Moreover, he still behaved well on the left corner in playoffs than the other one so the defending strategy against LeBron should be opposite to Stephen Curry.

### Analysis on shooting behavior in different periods of LeBron James 

Every basketball game has four periods and athletes would get exhausted when game is getting to the end, so it is important to arrange the rest and the rush hour properly. Therefore, let us take a look at the shooting behavior of LeBron James in different periods and hope to find some special patterns in it.

```{r}
shot_data %>%
  filter(player_name == "LeBron James") %>%
  filter(period!="5" & period!="6") %>%
  mutate(period = factor(period, levels = c("1", "2", "3", "4","Right Side(R)"))) %>%
  ggplot(aes(x = as.numeric(as.character(shot_distance)), group = period, fill = period)) +
  geom_density(alpha = 0.6) +
  theme(legend.position = c(0.9, 0.8)) +
  xlab("Shooting Distance")
```

Based on the plot, LeBron James prefers attacking the tim to shooting long-distance in the second quarter and among four periods it is last one that he attempted most threes. Therefore, there is one more defending policy against LeBron should be focusing more on his layups in the first half and his threes in the second half.

### Shooting Behavior of Giannis Antetokounmpo

Giannis Antetokounmpo, AKA Greek Freak, was experiencing his best seasons in past two years. MVP winner, All-star and last but not least, NBA championship. His athleticism is so phenomenol such that he could win all even without good shooting ability. While in the shock by shooting ability of Stephen Curry, let us take a look at Giannis Antetokounmpo, another side of basketball.

```{r}
library(ggalluvial)
shot_data %>%
  filter(player_name == 'Giannis Antetokounmpo') %>%
  mutate(shot_zone_range = factor(shot_zone_range, levels = c("Less Than 8 ft.", "8-16 ft.", "16-24 ft.","24+ ft.","Back Court Shot"))) %>%
  mutate(shot_zone_area = factor(shot_zone_area, levels = c("Left Side Center(LC)", "Right Side Center(RC)", "Center(C)", "Left Side(L)","Right Side(R)","Back Court(BC)"))) %>%
  arrange(event_type) %>%
  ggplot(aes(axis1 = shot_type, axis2 = shot_zone_area, axis3 = shot_zone_range))+
  geom_alluvium(aes(fill = event_type), width = 1/8)+
  geom_stratum(color = 'lightblue', width = 1/8)+
  geom_text(stat = "stratum", aes(label = after_stat(stratum)), size = 2)+
  scale_x_continuous(breaks = 1:3, 
       labels = c("FG Type", "Shot Area", "Shot Range"), expand = c(.01, .05))+
  ggtitle("Alluvial Diagram of Shooting Behavior of Giannis Antetokounmpo")+
  theme(legend.position="bottom",legend.title = element_text(size=5), legend.text = element_text(size=5))+
  ylab('Frequence')
```

Based on this alluvial diagram, we could see that Giannis Antetokounmpo in this season spent most his attempts on 2 pointers and two thirds of his shots happened less than 8 feet away from the basket. As a right-handed player, it seems like that he does not have preference on which side to shoot. Moreover, after comparing the shot attempted at left side center and right side center, we could find that he approached the rim more often from the left although he is right-handed. This might be inspirational to his defenders that it is better to focus on his left hand. At last, in his fewer long-distance attempts, he did not very well because we could see more blue flow in the long-distance area. Therefore, he still have a lot of potential to stimulate and there are more accomplishment waiting for him if he could work on his weakness.